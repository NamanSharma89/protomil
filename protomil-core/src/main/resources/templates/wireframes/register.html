<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">User Registration - Protomil</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.1"
            integrity="sha384-QWGpdj554B4ETpJJC9z+ZHJcA/i59TyjxEPXiiUgN2WmTyV5OEZWCD6gQhgkdpB/"
            crossorigin="anonymous"></script>

    <!-- Custom CSS -->
    <style>
        .protomil-brand {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .registration-card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }

        .error-text {
            color: #dc3545;
            font-size: 0.875rem;
        }

        .success-text {
            color: #198754;
            font-size: 0.875rem;
        }

        .password-strength {
            font-size: 0.875rem;
            padding: 0.25rem 0;
        }

        .password-strength.weak { color: #dc3545; }
        .password-strength.fair { color: #ffc107; }
        .password-strength.strong { color: #198754; }

        .form-floating .form-control {
            height: calc(3.5rem + 2px);
        }

        .validation-feedback {
            min-height: 1.25rem;
            font-size: 0.875rem;
        }

        .htmx-indicator {
            opacity: 0;
            transition: opacity 500ms ease-in;
        }

        .htmx-request .htmx-indicator {
            opacity: 1;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg protomil-brand">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/wireframes/">
            Protomil Core
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link text-white" href="/wireframes/">‚Üê Back to Home</a>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card registration-card">
                <div class="card-header protomil-brand text-center">
                    <h4 class="mb-0">User Registration</h4>
                    <small>Join the Protomil platform</small>
                </div>

                <div class="card-body p-4" id="main-content">
                    <!-- Success Message Fragment -->
                    <div th:fragment="success-message"
                         th:if="${registrationSuccess == true}"
                         class="alert alert-success" role="alert">
                        <h5 class="alert-heading">Registration Successful!</h5>
                        <p class="mb-2">Welcome to Protomil, <strong th:text="${userEmail}">user@example.com</strong>!</p>
                        <p class="mb-2">Your user ID is: <code th:text="${userId}">user-id</code></p>

                        <div th:if="${emailVerificationRequired == true}">
                            <hr>
                            <p class="mb-0">
                                <i class="bi bi-envelope-check"></i>
                                Please check your email to verify your account.
                            </p>
                        </div>

                        <div th:if="${adminApprovalRequired == true}">
                            <hr>
                            <p class="mb-0">
                                <i class="bi bi-clock-history"></i>
                                Your account is pending admin approval.
                            </p>
                        </div>
                    </div>

                    <!-- Error Message Fragment -->
                    <div th:fragment="error-message"
                         th:if="${hasErrors == true and errorMessage != null}"
                         class="alert alert-danger" role="alert">
                        <h6 class="alert-heading">Registration Failed</h6>
                        <p class="mb-0" th:text="${errorMessage}">An error occurred during registration.</p>
                    </div>

                    <!-- Registration Form Fragment -->
                    <div th:fragment="registration-form" id="registration-form">
                        <form th:object="${userRegistration}"
                              th:action="@{/wireframes/register}"
                              method="post"
                              hx-post="/wireframes/register"
                              hx-target="#main-content"
                              hx-indicator="#loading-indicator"
                              class="position-relative">

                            <!-- Loading Indicator -->
                            <div id="loading-indicator" class="htmx-indicator loading-overlay">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Processing...</span>
                                </div>
                            </div>

                            <!-- Personal Information -->
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text"
                                               class="form-control"
                                               th:classappend="${fieldErrors != null and fieldErrors.containsKey('firstName')} ? 'is-invalid' : ''"
                                               id="firstName"
                                               th:field="*{firstName}"
                                               placeholder="First Name"
                                               required>
                                        <label for="firstName">First Name *</label>
                                    </div>
                                    <div class="validation-feedback">
                                            <span th:if="${fieldErrors != null and fieldErrors.containsKey('firstName')}"
                                                  class="error-text"
                                                  th:text="${fieldErrors.firstName}"></span>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text"
                                               class="form-control"
                                               th:classappend="${fieldErrors != null and fieldErrors.containsKey('lastName')} ? 'is-invalid' : ''"
                                               id="lastName"
                                               th:field="*{lastName}"
                                               placeholder="Last Name"
                                               required>
                                        <label for="lastName">Last Name *</label>
                                    </div>
                                    <div class="validation-feedback">
                                            <span th:if="${fieldErrors != null and fieldErrors.containsKey('lastName')}"
                                                  class="error-text"
                                                  th:text="${fieldErrors.lastName}"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Email -->
                            <div class="mt-3">
                                <div class="form-floating">
                                    <input type="email"
                                           class="form-control"
                                           th:classappend="${fieldErrors != null and fieldErrors.containsKey('email')} ? 'is-invalid' : ''"
                                           id="email"
                                           th:field="*{email}"
                                           placeholder="name@company.com"
                                           hx-post="/wireframes/validate-email"
                                           hx-trigger="blur"
                                           hx-target="#email-feedback"
                                           required>
                                    <label for="email">Email Address *</label>
                                </div>
                                <div id="email-feedback" class="validation-feedback">
                                        <span th:if="${fieldErrors != null and fieldErrors.containsKey('email')}"
                                              class="error-text"
                                              th:text="${fieldErrors.email}"></span>
                                </div>
                            </div>

                            <!-- Phone Number -->
                            <div class="mt-3">
                                <div class="form-floating">
                                    <input type="tel"
                                           class="form-control"
                                           th:classappend="${fieldErrors != null and fieldErrors.containsKey('phoneNumber')} ? 'is-invalid' : ''"
                                           id="phoneNumber"
                                           th:field="*{phoneNumber}"
                                           placeholder="+919876543210"
                                           hx-post="/wireframes/validate-phone"
                                           hx-trigger="blur"
                                           hx-target="#phone-feedback"
                                           required>
                                    <label for="phoneNumber">Phone Number *</label>
                                </div>
                                <div id="phone-feedback" class="validation-feedback">
                                        <span th:if="${fieldErrors != null and fieldErrors.containsKey('phoneNumber')}"
                                              class="error-text"
                                              th:text="${fieldErrors.phoneNumber}"></span>
                                </div>
                            </div>

                            <!-- Password -->
                            <div class="mt-3">
                                <div class="form-floating">
                                    <input type="password"
                                           class="form-control"
                                           th:classappend="${fieldErrors != null and fieldErrors.containsKey('password')} ? 'is-invalid' : ''"
                                           id="password"
                                           th:field="*{password}"
                                           placeholder="Password"
                                           hx-post="/wireframes/check-password-strength"
                                           hx-trigger="keyup changed delay:300ms"
                                           hx-target="#password-feedback"
                                           required>
                                    <label for="password">Password *</label>
                                </div>
                                <div id="password-feedback" class="validation-feedback">
                                        <span th:if="${fieldErrors != null and fieldErrors.containsKey('password')}"
                                              class="error-text"
                                              th:text="${fieldErrors.password}"></span>
                                </div>
                            </div>

                            <!-- Optional Fields -->
                            <div class="row g-3 mt-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text"
                                               class="form-control"
                                               id="employeeId"
                                               th:field="*{employeeId}"
                                               placeholder="Employee ID">
                                        <label for="employeeId">Employee ID</label>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select"
                                                id="department"
                                                th:field="*{department}">
                                            <option value="">Select Department</option>
                                            <option value="Manufacturing">Manufacturing</option>
                                            <option value="Quality">Quality Control</option>
                                            <option value="Maintenance">Maintenance</option>
                                            <option value="Engineering">Engineering</option>
                                            <option value="Production">Production</option>
                                            <option value="Logistics">Logistics</option>
                                            <option value="Admin">Administration</option>
                                        </select>
                                        <label for="department">Department</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Terms and Conditions -->
                            <div class="mt-4">
                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           id="agreeTerms"
                                           required>
                                    <label class="form-check-label" for="agreeTerms">
                                        I agree to the <a href="#" target="_blank">Terms of Service</a>
                                        and <a href="#" target="_blank">Privacy Policy</a> *
                                    </label>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="d-grid mt-4">
                                <button type="submit"
                                        class="btn btn-primary btn-lg">
                                        <span class="htmx-indicator spinner-border spinner-border-sm me-2"
                                              role="status" aria-hidden="true"></span>
                                    Register Account
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Show form by default when no success/error states -->
                    <div th:if="${registrationSuccess != true and hasErrors != true}">
                        <div th:include="~{wireframes/register :: registration-form}"></div>
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="text-center mt-4">
                <small class="text-muted">
                    Already have an account? <a href="/login">Sign in here</a>
                </small>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>